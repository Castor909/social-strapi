<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub OAuth con Next.js y Strapi</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.6.1/dist/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.6.1/dist/reveal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.6.1/dist/theme/night.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.6.1/plugin/highlight/monokai.css">
    <style>
        .reveal h1, .reveal h2, .reveal h3 { text-transform: none; }
        .reveal pre { width: 100%; font-size: 0.55em; }
        .reveal code { font-family: 'Fira Code', monospace; }
        .reveal .slides section { text-align: left; }
        .reveal .slides section.center { text-align: center; }
        .reveal ul { font-size: 0.85em; }
        .reveal .highlight { color: #42affa; }
        .reveal .small { font-size: 0.7em; }
        .architecture-box { 
            background: rgba(66, 175, 250, 0.1); 
            border: 1px solid #42affa; 
            padding: 20px; 
            border-radius: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="reveal">
        <div class="slides">
            <!-- TÃ­tulo -->
            <section class="center">
                <h1>ğŸ” GitHub OAuth</h1>
                <h3>Next.js + Strapi</h3>
                <p class="small">AutenticaciÃ³n social moderna paso a paso</p>
            </section>

            <!-- Agenda -->
            <section>
                <h2>ğŸ“‹ Agenda</h2>
                <ul>
                    <li>Â¿Por quÃ© OAuth?</li>
                    <li>Flujo de autenticaciÃ³n</li>
                    <li>Arquitectura del proyecto</li>
                    <li>ImplementaciÃ³n paso a paso</li>
                    <li>Seguridad y mejores prÃ¡cticas</li>
                </ul>
            </section>

            <!-- Por quÃ© OAuth -->
            <section>
                <h2>ğŸ¤” Â¿Por quÃ© OAuth?</h2>
                <ul>
                    <li>Los usuarios <span class="highlight">odian crear cuentas</span></li>
                    <li>Menos fricciÃ³n = mÃ¡s conversiones</li>
                    <li>GitHub = identidad de desarrolladores</li>
                    <li>Delegamos la seguridad al experto</li>
                </ul>
            </section>

            <!-- OAuth vs Auth -->
            <section>
                <h2>ğŸ”‘ OAuth â‰  AutenticaciÃ³n</h2>
                <p><strong>OAuth 2.0</strong> es un protocolo de <span class="highlight">autorizaciÃ³n</span></p>
                <ul>
                    <li><strong>AutenticaciÃ³n:</strong> Â¿QuiÃ©n eres?</li>
                    <li><strong>AutorizaciÃ³n:</strong> Â¿QuÃ© puedes hacer?</li>
                </ul>
                <p class="small">Usamos la autorizaciÃ³n para obtener datos y autenticar</p>
            </section>

            <!-- Arquitectura -->
            <section>
                <h2>ğŸ—ï¸ Arquitectura</h2>
                <div class="architecture-box">
                    <p>Next.js (3000) â†’ Strapi (1337) â†’ GitHub</p>
                </div>
                <br>
                <ul>
                    <li><strong>Frontend:</strong> UI + Route Handler</li>
                    <li><strong>Backend:</strong> Strapi gestiona OAuth</li>
                    <li><strong>Provider:</strong> GitHub OAuth App</li>
                </ul>
            </section>

            <!-- Flujo completo -->
            <section>
                <h2>ğŸ”„ Flujo de Auth</h2>
                <ol class="small">
                    <li>Usuario click â†’ "Sign in with GitHub"</li>
                    <li>Redirect â†’ Strapi <code>/api/connect/github</code></li>
                    <li>Strapi â†’ GitHub login page</li>
                    <li>GitHub â†’ Strapi con cÃ³digo</li>
                    <li>Strapi intercambia cÃ³digo por token</li>
                    <li>Strapi â†’ Frontend con access_token</li>
                    <li>Frontend â†’ Strapi pide JWT</li>
                    <li>JWT guardado en cookie HttpOnly</li>
                </ol>
            </section>

            <!-- CÃ³digo: Login Button -->
            <section>
                <h2>ğŸ’» BotÃ³n de Login</h2>
                <pre><code class="typescript">// src/app/page.tsx
const backendUrl = process.env.NEXT_PUBLIC_BACKEND_URL;
const url = new URL(backendUrl + "/api/connect/github");

&lt;Link href={url.href}&gt;
  Sign in with GitHub
&lt;/Link&gt;</code></pre>
                <p class="small">Redirigimos a Strapi, no directamente a GitHub</p>
            </section>

            <!-- CÃ³digo: Route Handler -->
            <section>
                <h2>ğŸ’» Route Handler</h2>
                <pre><code class="typescript">// src/app/connect/[provider]/redirect/route.ts
export async function GET(request, { params }) {
  const token = searchParams.get("access_token");
  
  // Intercambiar por JWT de Strapi
  const res = await fetch(
    `${backendUrl}/api/auth/${provider}/callback?access_token=${token}`
  );
  const data = await res.json();
  
  // Guardar en cookie segura
  cookieStore.set("jwt", data.jwt, config);
  
  return NextResponse.redirect("/dashboard");
}</code></pre>
            </section>

            <!-- Seguridad: Cookies -->
            <section>
                <h2>ğŸ›¡ï¸ Cookies Seguras</h2>
                <pre><code class="typescript">const config = {
  maxAge: 60 * 60 * 24 * 7,  // 1 semana
  httpOnly: true,             // No JS access
  secure: true,               // Solo HTTPS
  path: "/",
  domain: "localhost"
};</code></pre>
                <p class="small"><code>httpOnly</code> previene robo de tokens vÃ­a XSS</p>
            </section>

            <!-- Middleware -->
            <section>
                <h2>ğŸš§ Middleware de ProtecciÃ³n</h2>
                <pre><code class="typescript">// src/middleware.ts
export async function middleware(request) {
  const user = await getUserMeLoader();
  
  if (request.nextUrl.pathname.startsWith("/dashboard") 
      && user.ok === false) {
    return NextResponse.redirect("/");
  }
  
  return NextResponse.next();
}</code></pre>
            </section>

            <!-- Por quÃ© verificar con Strapi -->
            <section>
                <h2>â“ Â¿Por quÃ© verificar con Strapi?</h2>
                <p>La cookie podrÃ­a existir pero...</p>
                <ul>
                    <li>El token expirÃ³ en el servidor</li>
                    <li>El usuario fue deshabilitado</li>
                    <li>El token fue revocado</li>
                </ul>
                <p class="highlight">Strapi es la fuente de verdad</p>
            </section>

            <!-- Server Actions -->
            <section>
                <h2>âš¡ Server Actions para Logout</h2>
                <pre><code class="typescript">async function logoutAction() {
  "use server";
  
  const cookieStore = await cookies();
  cookieStore.set("jwt", "", { ...config, maxAge: 0 });
  
  redirect("/");
}</code></pre>
                <p class="small">Sin API routes adicionales</p>
            </section>

            <!-- ConfiguraciÃ³n Strapi -->
            <section>
                <h2>âš™ï¸ ConfiguraciÃ³n Strapi</h2>
                <ol>
                    <li>Admin â†’ Settings â†’ Providers</li>
                    <li>Habilitar GitHub</li>
                    <li>Client ID + Client Secret</li>
                    <li>Redirect URL del frontend</li>
                </ol>
                <pre><code>Redirect: http://localhost:3000/connect/github/redirect</code></pre>
            </section>

            <!-- GitHub OAuth App -->
            <section>
                <h2>ğŸ™ GitHub OAuth App</h2>
                <p>Settings â†’ Developer Settings â†’ OAuth Apps</p>
                <ul>
                    <li><strong>Homepage:</strong> http://localhost:3000</li>
                    <li><strong>Callback:</strong> http://localhost:1337/api/connect/github/callback</li>
                </ul>
                <p class="small">El callback apunta a Strapi, no al frontend</p>
            </section>

            <!-- Extensibilidad -->
            <section>
                <h2>ğŸ”Œ Extensibilidad</h2>
                <p>El segmento dinÃ¡mico <code>[provider]</code> permite:</p>
                <ul>
                    <li>/connect/<span class="highlight">google</span>/redirect</li>
                    <li>/connect/<span class="highlight">twitter</span>/redirect</li>
                    <li>/connect/<span class="highlight">discord</span>/redirect</li>
                </ul>
                <p class="small">Solo configura el provider en Strapi</p>
            </section>

            <!-- Mejores prÃ¡cticas -->
            <section>
                <h2>âœ… Mejores PrÃ¡cticas</h2>
                <ul>
                    <li>Nunca exponer Client Secret en frontend</li>
                    <li>HTTPS obligatorio en producciÃ³n</li>
                    <li>No cachear datos de autenticaciÃ³n</li>
                    <li>Implementar rate limiting</li>
                    <li>Manejar errores gracefully</li>
                </ul>
            </section>

            <!-- Estructura del proyecto -->
            <section>
                <h2>ğŸ“ Estructura</h2>
                <pre><code>frontend/src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx           # Login
â”‚   â”œâ”€â”€ dashboard/         # Protected
â”‚   â””â”€â”€ connect/[provider]/redirect/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ LogoutButton.tsx
â”œâ”€â”€ services/
â”‚   â””â”€â”€ user-me-loader.ts
â””â”€â”€ middleware.ts</code></pre>
            </section>

            <!-- Demo -->
            <section class="center">
                <h2>ğŸ¬ Demo Time</h2>
                <p>Frontend: <code>http://localhost:3000</code></p>
                <p>Backend: <code>http://localhost:1337</code></p>
            </section>

            <!-- Recursos -->
            <section>
                <h2>ğŸ“š Recursos</h2>
                <ul>
                    <li>Strapi Providers Docs</li>
                    <li>Next.js Route Handlers</li>
                    <li>GitHub OAuth Documentation</li>
                    <li>OAuth 2.0 RFC 6749</li>
                </ul>
            </section>

            <!-- Final -->
            <section class="center">
                <h1>ğŸ™ Â¡Gracias!</h1>
                <p>Â¿Preguntas?</p>
                <br>
                <p class="small">github.com/tu-usuario/social-strapi</p>
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.6.1/dist/reveal.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.6.1/plugin/highlight/highlight.js"></script>
    <script>
        Reveal.initialize({
            hash: true,
            slideNumber: true,
            plugins: [ RevealHighlight ],
            transition: 'slide'
        });
    </script>
</body>
</html>
